<!DOCTYPE html>
<html lang="he" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מערכת שעות - מיכל פילאטיס</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/navbar.css">
    <link rel="stylesheet" href="css/schedule.css">
</head>

<body class="page-loading" id="page_schedule">

    <div id="navbar-placeholder"></div>

    <header>
        <h1 class="headers">מערכת שעות שבועית</h1>
    </header>

     <!-- לוח הודעות - תוכן נטען ב-JS -->
    <div class="notice-board">
        <h2><i class="fas fa-bullhorn"></i> לוח הודעות ועדכונים</h2>
        <div id="notices-container"></div>
    </div>

        <!-- ניווט בין שבועות - פונקציות ב-schedule.js -->
    <div class="week-navigation">
         <!-- שבוע קודם -->
        <div class="nav-slot nav-slot-prev">
            <button class="nav-btn btn" onclick="changeWeek(-1)">
                <i class="fas fa-chevron-right"></i> שבוע שעבר
            </button>
        </div>
         <!-- חזרה לשבוע נוכחי -->
        <div class="nav-slot nav-slot-current">
            <button class="nav-btn btn" onclick="goToCurrentWeek()">
                שבוע נוכחי
            </button>
        </div>
        <!-- שבוע הבא -->
        <div class="nav-slot nav-slot-next">
            <button id="btn-next-week" class="nav-btn btn" onclick="changeWeek(1)">
                שבוע הבא <i class="fas fa-chevron-left"></i>
            </button>
        </div>
    </div>

     <!-- כפתורי אדמין - מוסתרים למשתמשים רגילים -->
    <div class="schedule-container text-start">
        <button id="btn-add-class-mode" class="btn btn-success" style="display: none;">   <!-- כפתור אדמין: הוספת שיעור חדש -->
            הוספת שיעור חדש
        </button>

        <button id="btn-generate-next-week" class="btn btn-primary" style="display: none;">   <!--כפתור אדמין: יצירת מערכת לשבוע שמוצג כרגע על פי פריסט קבוע-->
            צרי מערכת לשבוע המוצג
        </button>
    </div>

     <!-- טבלת השיעורים השבועית - 6 ימי עבודה (ראשון-שישי) -->
    <div class="schedule-container">
        <div class="week-grid">

            <div class="day-column">
                <div class="date-display" id="date-0"></div>
                <div class="day-header">יום ראשון</div>
                <div class="day-content" id="day-content-0" data-day="ראשון"></div>
            </div>

            <div class="day-column">
                <div class="date-display" id="date-1"></div>
                <div class="day-header">יום שני</div>
                <div class="day-content" id="day-content-1" data-day="שני"></div>
            </div>

            <div class="day-column">
                <div class="date-display" id="date-2"></div>
                <div class="day-header">יום שלישי</div>
                <div class="day-content" id="day-content-2" data-day="שלישי"></div>
            </div>

            <div class="day-column">
                <div class="date-display" id="date-3"></div>
                <div class="day-header">יום רביעי</div>
                <div class="day-content" id="day-content-3" data-day="רביעי"></div>
            </div>

            <div class="day-column">
                <div class="date-display" id="date-4"></div>
                <div class="day-header">יום חמישי</div>
                <div class="day-content" id="day-content-4" data-day="חמישי"></div>
            </div>

            <div class="day-column">
                <div class="date-display" id="date-5"></div>
                <div class="day-header">יום שישי</div>
                <div class="day-content" id="day-content-5" data-day="שישי"></div>
            </div>
        </div>
    </div>

        <!-- פאנל ניהול שיעור אדמין - מוסתר בהתחלה -->
    <div id="admin-class-manager" class="container mt-4 mb-5 p-4 border rounded shadow bg-white"
        style="display: none; max-width: 900px;">
        <h3 class="text-center mb-4 border-bottom pb-2">  <!-- כותרת של השיעור הנבחר -->
            ניהול שיעור: <span id="manager-class-name" class="text-primary fw-bold"></span>
            <span id="manager-class-time" class="fs-5 text-muted ms-2"></span>
        </h3>

         <!-- בלוק הוספת מתאמנים לשיעור - dropdown + חיפוש -->
        <div class="row mb-4 bg-light p-3 rounded mx-0">
            <div class="col-md-12 d-flex align-items-end justify-content-start gap-3">
                <div class="select-wrapper" style="width: 100%; position: relative;">
                    <label class="form-label fw-bold d-block">הוספת מתאמן לשיעור:</label>

                    <div class="custom-select-trigger" onclick="toggleUserDropdown()">
                        <span id="selected-user-text">-- בחר/י מתאמן להוספה --</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>

                    <div id="custom-dropdown-container" class="custom-dropdown-content" style="display: none;">
                        <input type="text" id="user-search-input" class="form-control m-2" style="width: auto;"
                            placeholder="הקלד/י שם לחיפוש..." onkeyup="filterUsersList()">

                        <select id="all-users-select" class="form-select border-0" size="5"
                            onclick="selectUserFromList()">
                            <option value="">-- טוען רשימת מתאמנים... --</option>
                        </select>
                    </div>
                </div>
                 <!-- כפתור הוספת מתאמן לשיעור -->
                <button class="btn btn-success fw-bold btn-add-user" onclick="adminAddUserToClass()"> 
                    <i class="fas fa-plus-circle"></i> הוסף לשיעור
                </button>
            </div>
        </div>

         <!-- רשימות משתתפים - רשומים + המתנה -->
        <div class="row">
             <!-- רשימת רשומים -->
            <div class="col-md-6 border-end">
                <h5 class="text-success border-bottom pb-2">
                    <i class="fas fa-check-circle"></i> רשומים לשיעור (<span id="count-registered">0</span>)
                </h5>
                <ul id="list-registered" class="list-group list-group-flush mt-2"
                    style="max-height: 300px; overflow-y: auto;">
                </ul>
            </div>

            <!-- רשימת המתנה -->
            <div class="col-md-6 mt-3 mt-md-0">
                <h5 class="waitlist-title border-bottom pb-2">
                    <i class="fas fa-clock"></i> רשימת המתנה (<span id="count-waitlist">0</span>)
                </h5>
                <ul id="list-waitlist" class="list-group list-group-flush mt-2"
                    style="max-height: 300px; overflow-y: auto;">
                </ul>
            </div>
        </div>

        <!-- כפתור סגירה לניהול שיעור -->
        <div class="text-center mt-4 pt-3 border-top">
            <button class="btn btn-secondary px-4"
                onclick="document.getElementById('admin-class-manager').style.display='none'">
                סגור ניהול
            </button>
        </div>
    </div>

    <!-- מודל Bootstrap - הוספה/עריכת שיעור -->
    <div class="modal fade" id="classModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header custom-modal-header">
                    <h5 class="modal-title" id="modalTitle">ניהול שיעור</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="formClass">
                        <input type="hidden" id="classId">

                        <!-- בחירת סוג שיעור -->
                        <div class="mb-3">
                            <label>שם השיעור</label>
                            <select id="className" class="form-select" required>
                                <option value="פילאטיס מזרן קלאסי">פילאטיס מזרן קלאסי</option>
                                <option value="פילאטיס עם כדור גדול">פילאטיס עם כדור גדול</option>
                                <option value="פילאטיס עם כדור קטן">פילאטיס עם כדור קטן</option>
                                <option value="פילאטיס עם גליל">פילאטיס עם גליל</option>
                                <option value="פילאטיס עם פיתה בלאנס">פילאטיס עם פיתה בלאנס</option>
                                <option value="פילאטיס עם משקולות">פילאטיס עם משקולות</option>
                                <option value="תנועה ומתיחות">תנועה ומתיחות</option>
                            </select>
                        </div>

                        <!-- תאריך שיעור -->
                        <div class="mb-3">
                            <label>תאריך</label>
                            <input type="date" id="classDate" class="form-control" required>
                        </div>

                        <!-- יום + מקסימום משתתפים -->
                        <div class="row">
                            <div class="col">
                                <label>יום</label>
                                <select id="classDay" class="form-select">
                                    <option>ראשון</option>
                                    <option>שני</option>
                                    <option>שלישי</option>
                                    <option>רביעי</option>
                                    <option>חמישי</option>
                                    <option>שישי</option>
                                </select>
                            </div>
                            <div class="col">
                                <label>מספר משתתפים מקסימלי</label>
                                <input type="number" id="maxParticipants" class="form-control" value="8">
                            </div>
                        </div>

                        <!-- שעות התחלה/סיום -->
                        <div class="row mt-3">
                            <div class="col">
                                <label>התחלה</label>
                                <input type="time" id="startTime" class="form-control" required>
                            </div>
                            <div class="col">
                                <label>סיום</label>
                                <input type="time" id="endTime" class="form-control" required>
                            </div>
                        </div>

                        <!-- אופציית שיעור זום -->
                        <div class="mt-3 zoom-check-wrapper">
                            <input type="checkbox" class="form-check-input zoom-checkbox" id="isZoom">
                            <label class="form-check-label" for="isZoom">שיעור זום?</label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer"> <!--הודעה קופצת לשמירה/ביטול השיעור-->
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ביטול</button>
                    <button type="button" class="btn btn-primary" onclick="submitClassForm()">שמור שיעור</button>
                </div>
            </div>
        </div>
    </div>

    <div id="footer-placeholder"></div> <!--פוטר-->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/main.js"></script>
    <script src="js/schedule.js"></script>

</body>

</html>